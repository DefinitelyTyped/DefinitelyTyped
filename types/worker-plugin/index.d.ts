import webpack = require("webpack");

export = WorkerPlugin;

declare class WorkerPlugin implements webpack.WebpackPluginInstance {
    constructor(options?: WorkerPlugin.Options);
    apply(compiler: webpack.Compiler): void;
}

declare namespace WorkerPlugin {
    interface Options {
        /**
         * Controls the name of the generated worker chunk.
         * The name is used to generate a URL according to `output.chunkFilename`.
         */
        filename?: string | undefined;

        /**
         * Controls the chunk filename of secondary chunks generated by the worker bundle.
         * Defaults to the parent compiler's `output.chunkFilename`.
         */
        chunkFilename?: string | undefined;

        /**
         * Configures the value of `output.globalObject` for WorkerPlugin's internal Webpack compiler.
         * Set to `false` to disable the warning when `output.globalObject` is set to `"window"`.
         * Defaults to `"self"`, which is required for HMR to work correctly in workers.
         */
        globalObject?: false | string | undefined;

        /**
         * List of Webpack plugins to apply to the worker's child compiler.
         * By default, no plugins from the parent compiler are applied to avoid running things
         * like `html-webpack-plugin` twice. Pass a plugin name string to copy it from the
         * parent compiler's configuration, or pass a plugin instance to apply it only to worker code.
         */
        plugins?: Array<string | webpack.WebpackPluginInstance> | undefined;

        /**
         * If set to `true`, enables bundling of
         * [`SharedWorker`](https://developer.mozilla.org/en-US/docs/Web/API/SharedWorker).
         * @default false
         */
        sharedWorker?: boolean | undefined;

        /**
         * If set to `false`, disables bundling of `Worker`.
         * Intended to be used with `{ sharedWorker: true }` to bundle `SharedWorker` only.
         * @default true
         */
        worker?: boolean | undefined;

        /**
         * If set to `true`, retains `{ type: 'module' }` in the bundled output instead of
         * removing it. By default, WorkerPlugin removes the `type` option to compile
         * Module Workers to Classic Workers, which are supported in all browsers.
         * @default false
         */
        preserveTypeModule?: boolean | undefined;

        /**
         * Override the `type` value output by WorkerPlugin in the worker constructor options.
         * For example, setting `workerType: 'foo'` will output `new Worker('a.worker.js', { type: 'foo' })`.
         * Takes precedence over `preserveTypeModule`.
         */
        workerType?: string | undefined;
    }
}
