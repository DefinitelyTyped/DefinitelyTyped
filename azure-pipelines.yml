# Learn more at: https://aka.ms/yaml
jobs:
- job: npmRunTest
  pool:
    vmImage: 'Ubuntu 16.04'
    demands: npm

  timeoutInMinutes: 360

  steps:
  #- task: Npm@1
  #  displayName: 'npm install'
  #  inputs:
  #    verbose: false

  - script: |
      if [[ $BUILD_REASON == "Schedule" ]]; then git config --global user.email "types@microsoft.com" && git config --global user.name "TypeScript Bot" && npm run update-codeowners; fi
      git checkout -- .

      git clone https://github.com/microsoft/DefinitelyTyped-tools.git
      curl https://patch-diff.githubusercontent.com/raw/microsoft/DefinitelyTyped-tools/pull/100.patch | patch --directory DefinitelyTyped-tools --strip 1
      yarn --cwd DefinitelyTyped-tools
      tsc --build DefinitelyTyped-tools/packages/dtslint-runner
      node DefinitelyTyped-tools/packages/dtslint-runner/dist/index.js --path .


    displayName: 'npm run test'

trigger:
- master
