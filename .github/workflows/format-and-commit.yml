name: Format And Commit

concurrency:
  group: ${{ github.ref }}

on:
    # Pending getting through individual PRs.
    # push:
    #   branches:
    #     - master
    workflow_dispatch: ~

permissions:
  contents: read

jobs:
  dprint-fmt:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-node@v3
      with:
        node-version: '16'
    - run: npm install
    - uses: actions/cache@v3
      with:
        key: ${{ runner.os }}-dprint-${{ hashFiles('package-lock.json', '.dprint.jsonc') }}
        path: ~/.cache/dprint
        restore-keys: |
          ${{ runner.os }}-dprint-
    - run: npx dprint fmt
    - uses: stefanzweifel/git-auto-commit-action@v4.16.0
      with:
        commit_author: "TypeScript Bot <actions@github.com>"
        commit_message: "chore: npx dprint fmt"
        commit_user_email: "typescriptbot@microsoft.com"
        commit_user_name: "TypeScript Bot"
